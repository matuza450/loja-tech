<div id="comments">
  <h4>Comentários</h4>

  <% if logged_in? %>
    <%= form_with(model: [product, Comment.new], local: true) do |f| %>
      <div class="form-group">
        <%= f.label :body, "Deixe um comentário" %>
        <%= f.text_area :body, class: "form-control", rows: 3 %>
      </div>
      <%= f.submit "Comentar", class: "btn btn-primary btn-sm mt-2" %>
    <% end %>
  <% else %>
    <p><%= link_to 'Faça login', login_path %> para comentar.</p>
  <% end %>

  <div class="mt-3">
    <% product.comments.order(created_at: :desc).each do |comment| %>
      <div class="card mb-2">
        <div class="card-body">
          <strong><%= comment.user.name %></strong>
          <small class="text-muted"> • <%= time_ago_in_words(comment.created_at) %> atrás</small>
          <p class="mb-0 mt-2"><%= comment.body %></p>
          <% if logged_in? && comment.user == current_user %>
            <%= button_to [product, comment], method: :delete, data: { confirm: 'Remover comentário?' }, class: "btn btn-link btn-sm text-danger mt-2" do %>
              Remover
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>