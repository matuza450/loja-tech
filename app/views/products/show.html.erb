<p class="muted"><%= notice %></p>

<div class="container mt-4">
  <div class="row">
    <div class="col-md-6">
      <div class="product-images">
        <% if @product.images.attached? %>
          <div class="main-image-container mb-3">
            <%= image_tag @product.images.first.variant(resize_to_limit: [600, 400]), class: "main-image", id: "main-product-image" %>
          </div>
          <div class="product-thumbnails d-flex gap-2">
            <% @product.images.each_with_index do |image, index| %>
              <%= image_tag image.variant(resize_to_limit: [100, 100]), 
                          class: "product-thumbnail #{index == 0 ? 'active' : ''}", 
                          data: { 
                            action: "click->product#switchImage",
                            image_url: url_for(image.variant(resize_to_limit: [600, 400]))
                          } %>
            <% end %>
          </div>
        <% else %>
          <%= image_tag "placeholder-product.svg", class: "main-image", alt: "placeholder" %>
        <% end %>
      </div>
    </div>
    
    <div class="col-md-6">
      <h1 class="mb-3"><%= @product.name %></h1>
      <p class="lead mb-4"><%= @product.description %></p>
      
      <div class="mb-4">
        <h3 class="price">R$ <%= number_with_precision(@product.price, precision: 2, delimiter: ",") %></h3>
        <p class="text-muted">Estoque: <%= @product.stock %></p>
      </div>

      <% if logged_in? %>
        <%= button_to cart_add_item_path(product_id: @product), 
                    class: "btn btn-primary btn-lg mb-4",
                    data: { turbo: true } do %>
          <i class="fas fa-shopping-cart me-2"></i> Adicionar ao Carrinho
        <% end %>
      <% else %>
        <%= link_to login_path, class: "btn btn-primary btn-lg mb-4" do %>
          <i class="fas fa-sign-in-alt me-2"></i> Login para Comprar
        <% end %>
      <% end %>

      <div class="d-flex gap-2">
        <% if logged_in? %>
          <%= link_to edit_product_path(@product), class: "btn btn-outline-secondary" do %>
            <i class="fas fa-edit me-1"></i> Editar
          <% end %>
          <%= button_to @product, 
                      method: :delete, 
                      class: "btn btn-outline-danger",
                      data: { turbo_confirm: "Tem certeza?" } do %>
            <i class="fas fa-trash-alt me-1"></i> Excluir
          <% end %>
        <% end %>
        <%= link_to products_path, class: "btn btn-outline-primary" do %>
          <i class="fas fa-arrow-left me-1"></i> Voltar
        <% end %>
      </div>
    </div>
  </div>
</div>
